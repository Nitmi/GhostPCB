# GhostPCB - PCB 反拆单检测方案

### 0. Gerber 文件内部时间修改

生成一个合理的随机时间，使用正则，批量替换 Gerber 中的时间信息。

### 1. 丝印层（Silkscreen）扰动 —— 成本最低，效果最好

丝印是不影响电气特性的。通过微调非关键字符，可以轻易改变文件哈希和视觉特征。

- **位移扰动：** 将所有元器件位号（如 R1, C1）在不重叠的情况下，随机移动 $0.01mm \sim 0.05mm$。这种微小的位移在生产中可以忽略不计，但在坐标数据上完全不同。
- **字体/字宽缩放：** 将文字的高度或线宽改变 $1\%$。例如从 $1.0mm$ 改为 $0.99mm$。
- **添加“指纹”锚点：** 在板卡边缘（非布线区）自动生成一个极小的、随机形状的丝印图案或版本号字符串。

### 2. 几何结构扰动 —— 改变特征向量

系统可能会通过计算孔位分布、铜皮重心来比对。

- **钻孔坐标随机偏移：** 只要在公差范围内（比如 $\pm 0.02mm$），将所有过孔（VIA）坐标进行细微的随机抖动。这不会影响插件，但会彻底改变钻孔文件的哈希。
- **过孔直径微调：** 将 $0.3mm$ 的过孔改为 $0.31mm$ 或 $0.29mm$（需确认工艺允许）。
- **泪滴（Teardrops）重绘：** 重新生成泪滴，改变其弧度或长度。由于泪滴包含大量的微小多边形，稍微调整参数就会产生完全不同的 Gerber 数据。

### 3. Gerber 文件结构混淆 —— 应对简单哈希

- **坐标格式变换：** Gerber 支持绝对坐标和相对坐标，支持不同的精度（如 2:4, 3:5）。转换坐标表达方式可以实现“内容相同但二进制不同”。
- **填充算法改变：** 同样一块大面积铺铜，可以使用“光栅扫描”填充，也可以用“多边形”定义。改变铺铜的描述方式是极佳的混淆手段。
- **插入冗余指令：** 在 Gerber 代码中插入大量的无意义指令（如重复的选择工具指令 `Dxx*`），或者在文件尾部添加随机噪声注释。

### 4. 物理参数微调

- **外框尺寸（Outline）：** 将板子长宽分别增加 $0.01mm$。在物理切割上这几乎不可感知，但系统在录入尺寸时会记录下不同的数值。
- **倒角半径：** 如果板角有圆角，微调圆角半径（如从 $2.0mm$ 改为 $2.05mm$）。

------

### 建议的程序逻辑架构

为了实现自动化，你的程序建议按照以下流程运行：

| **步骤**    | **动作**                           | **技术要点**                       |
| ----------- | ---------------------------------- | ---------------------------------- |
| **1. 解析** | 读取原始 Gerber 文件夹             | 解析 D-Code 和坐标数据             |
| **2. 抖动** | 对 `GTL/GBL`（走线层）进行坐标微调 | 引入 $\sigma < 0.01mm$ 的高斯噪声  |
| **3. 重绘** | 对 `GTO/GBO`（丝印层）重新渲染     | 改变位号坐标和字体比例             |
| **4. 混淆** | 重新排布 Gerber 指令顺序           | 打乱非依赖性指令的先后顺序         |
| **5. 验证** | 模拟 DRC 检查                      | 确保扰动后的数据没有造成短路或开路 |

